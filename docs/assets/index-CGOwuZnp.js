(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))C(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const b of d.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&C(b)}).observe(document,{childList:!0,subtree:!0});function R(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function C(c){if(c.ep)return;c.ep=!0;const d=R(c);fetch(c.href,d)}})();window.onload=function(){const r=document.getElementById("viewport"),n=r.getContext("2d");function R(){r.width=window.innerWidth,r.height=window.innerHeight,o.x=r.width*.05,o.y=r.height*.22,o.tilewidth=r.width*.8/o.columns,o.tileheight=r.height*.65/o.rows,p[0].x=r.width*.05,p[0].y=r.height*.06,p[1].x=r.width*.05,p[1].y=r.height*.11,p[2].x=r.width*.05,p[2].y=r.height*.16,N=r.width*.2,V=r.height*.02}window.addEventListener("resize",R);let C=0,c=0,d=0,b=0,T=!1;const o={x:250,y:113,columns:8,rows:8,tilewidth:40,tileheight:40,tiles:[],selectedtile:{selected:!1,column:0,row:0}},E=[[255,128,128],[128,255,128],[128,128,255],[255,255,128],[255,128,255],[128,255,255],[255,255,255]];let h=[],L=[],f={column1:0,row1:0,column2:0,row2:0};const w={init:0,ready:1,resolve:2};let g=w.init,A=0,a=0,u=0;const x=.3;let O=!1,B=!1,P=!1;const p=[{x:30,y:240,width:150,height:50,text:"New Game"},{x:30,y:300,width:150,height:50,text:"Show Moves"},{x:30,y:360,width:150,height:50,text:"Enable AI Bot"}];function J(){r.addEventListener("mousemove",re),r.addEventListener("mousedown",fe),r.addEventListener("mouseup",ce),r.addEventListener("mouseout",ue);for(let e=0;e<o.columns;e++){o.tiles[e]=[];for(let t=0;t<o.rows;t++)o.tiles[e][t]={type:0,shift:0}}D(),$(0)}function $(e){window.requestAnimationFrame($),Q(e),k()}function Q(e){const t=(e-C)/1e3;if(C=e,Z(t),g===w.ready){if(L.length<=0&&(P=!0),B&&(u+=t,u>x)){const l=de();l&&G(l.column1,l.row1,l.column2,l.row2),u=0}}else if(g===w.resolve){if(u+=t,a===0){if(u>x){if(m(),h.length>0){for(const l of h)A+=100*(l.length-2);X(),a=1}else g=w.ready;u=0}}else a===1?u>x&&(Y(),a=0,u=0,m(),h.length<=0&&(g=w.ready)):a===2?u>x&&(y(f.column1,f.row1,f.column2,f.row2),m(),h.length>0?(a=0,u=0,g=w.resolve):(a=3,u=0),I(),m()):a===3&&u>x&&(y(f.column1,f.row1,f.column2,f.row2),g=w.ready);I(),m()}}function Z(e){c>.25&&(b=Math.round(d/c),c=0,d=0),c+=e,d++}function F(e,t,l,i){const s=n.measureText(e);n.fillText(e,t+(i-s.width)/2,l)}function _(){n.fillStyle="#d0d0d0",n.fillRect(0,0,r.width,r.height),n.fillStyle="#e8eaec",n.fillRect(1,1,r.width-2,r.height-2),n.fillStyle="#303030",n.fillRect(0,0,r.width,65),n.fillStyle="#ffffff",n.font="24px Verdana",n.fillText("match",10,30),n.fillStyle="#ffffff",n.font="12px Verdana",n.fillText(`Fps: ${b}`,13,50)}let N=30,V=40;function k(){_(),n.fillStyle="#000000",n.font="24px Verdana",F("Score:",N,V,150),F(A.toString(),N,V+30,150),ee();const e=o.columns*o.tilewidth,t=o.rows*o.tileheight;n.fillStyle="#000000",n.fillRect(o.x-4,o.y-4,e+8,t+8),te(),le(),O&&h.length<=0&&g===w.ready&&oe(),P&&(n.fillStyle="rgba(0, 0, 0, 0.8)",n.fillRect(o.x,o.y,e,t),n.fillStyle="#ffffff",n.font="24px Verdana",F("Game Over!",o.x,o.y+t/2+10,e))}function ee(){for(const e of p){n.fillStyle="#000000",n.fillRect(e.x,e.y,e.width,e.height),n.fillStyle="#ffffff",n.font="18px Verdana";const t=n.measureText(e.text);n.fillText(e.text,e.x+(e.width-t.width)/2,e.y+30)}}function te(){for(let e=0;e<o.columns;e++)for(let t=0;t<o.rows;t++){const l=o.tiles[e][t].shift,i=v(e,t,0,u/x*l);if(o.tiles[e][t].type>=0){const s=E[o.tiles[e][t].type];M(i.tilex,i.tiley,s[0],s[1],s[2])}o.selectedtile.selected&&o.selectedtile.column===e&&o.selectedtile.row===t&&M(i.tilex,i.tiley,255,0,0)}if(g===w.resolve&&(a===2||a===3)){const e=f.column2-f.column1,t=f.row2-f.row1,l=v(f.column1,f.row1,0,0),i=v(f.column1,f.row1,u/x*e,u/x*t),s=E[o.tiles[f.column1][f.row1].type],S=v(f.column2,f.row2,0,0),z=v(f.column2,f.row2,u/x*-e,u/x*-t),j=E[o.tiles[f.column2][f.row2].type];M(l.tilex,l.tiley,0,0,0),M(S.tilex,S.tiley,0,0,0),a===2?(M(i.tilex,i.tiley,s[0],s[1],s[2]),M(z.tilex,z.tiley,j[0],j[1],j[2])):(M(z.tilex,z.tiley,j[0],j[1],j[2]),M(i.tilex,i.tiley,s[0],s[1],s[2]))}}function v(e,t,l,i){const s=o.x+(e+l)*o.tilewidth,S=o.y+(t+i)*o.tileheight;return{tilex:s,tiley:S}}function M(e,t,l,i,s){n.fillStyle=`rgb(${l},${i},${s})`,n.fillRect(e+2,t+2,o.tilewidth-4,o.tileheight-4)}function le(){for(const e of h){const t=v(e.column,e.row,0,0);e.horizontal?(n.fillStyle="#00ff00",n.fillRect(t.tilex+o.tilewidth/2,t.tiley+o.tileheight/2-4,(e.length-1)*o.tilewidth,8)):(n.fillStyle="#0000ff",n.fillRect(t.tilex+o.tilewidth/2-4,t.tiley+o.tileheight/2,8,(e.length-1)*o.tileheight))}}function oe(){for(const e of L){const t=v(e.column1,e.row1,0,0),l=v(e.column2,e.row2,0,0);n.strokeStyle="#ff0000",n.beginPath(),n.moveTo(t.tilex+o.tilewidth/2,t.tiley+o.tileheight/2),n.lineTo(l.tilex+o.tilewidth/2,l.tiley+o.tileheight/2),n.stroke()}}function D(){A=0,g=w.ready,P=!1,ie(),I(),m()}function ie(){let e=!1;for(;!e;){for(let t=0;t<o.columns;t++)for(let l=0;l<o.rows;l++)o.tiles[t][l].type=H();ne(),I(),L.length>0&&(e=!0)}}function H(){return Math.floor(Math.random()*E.length)}function ne(){for(m();h.length>0;)X(),Y(),m()}function q(){let e=0;const t=m();for(const l of t)e+=(l.length-2)*100;return e}function m(){const e=[];for(let t=0;t<o.rows;t++){let l=1;for(let i=0;i<o.columns;i++){let s=!1;i===o.columns-1?s=!0:o.tiles[i][t].type===o.tiles[i+1][t].type&&o.tiles[i][t].type!==-1?l++:s=!0,s&&(l>=3&&e.push({column:i+1-l,row:t,length:l,horizontal:!0}),l=1)}}for(let t=0;t<o.columns;t++){let l=1;for(let i=0;i<o.rows;i++){let s=!1;i===o.rows-1?s=!0:o.tiles[t][i].type===o.tiles[t][i+1].type&&o.tiles[t][i].type!==-1?l++:s=!0,s&&(l>=3&&e.push({column:t,row:i+1-l,length:l,horizontal:!1}),l=1)}}return e}function I(){L=[];for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns-1;t++)y(t,e,t+1,e),m(),y(t,e,t+1,e),h.length>0&&L.push({column1:t,row1:e,column2:t+1,row2:e});for(let e=0;e<o.columns;e++)for(let t=0;t<o.rows-1;t++)y(e,t,e,t+1),m(),y(e,t,e,t+1),h.length>0&&L.push({column1:e,row1:t,column2:e,row2:t+1});h=[]}function se(e){for(let t=0;t<h.length;t++){const l=h[t];let i=0,s=0;for(let S=0;S<l.length;S++)e(t,l.column+i,l.row+s,l),l.horizontal?i++:s++}}function X(){se((e,t,l,i)=>{console.info(e),console.info(i),o.tiles[t][l].type=-1});for(let e=0;e<o.columns;e++){let t=0;for(let l=o.rows-1;l>=0;l--)o.tiles[e][l].type===-1?(t++,o.tiles[e][l].shift=0):o.tiles[e][l].shift=t}}function Y(){for(let e=0;e<o.columns;e++)for(let t=o.rows-1;t>=0;t--){if(o.tiles[e][t].type===-1)o.tiles[e][t].type=H();else{const l=o.tiles[e][t].shift;l>0&&y(e,t,e,t+l)}o.tiles[e][t].shift=0}}function K(e){const t=Math.floor((e.x-o.x)/o.tilewidth),l=Math.floor((e.y-o.y)/o.tileheight);return t>=0&&t<o.columns&&l>=0&&l<o.rows?{valid:!0,x:t,y:l}:{valid:!1,x:0,y:0}}function U(e,t,l,i){return Math.abs(e-l)===1&&t===i||Math.abs(t-i)===1&&e===l}function y(e,t,l,i){const s=o.tiles[e][t].type;o.tiles[e][t].type=o.tiles[l][i].type,o.tiles[l][i].type=s}function G(e,t,l,i){f={column1:e,row1:t,column2:l,row2:i},o.selectedtile.selected=!1,a=2,u=0,g=w.resolve}function re(e){const t=W(r,e);if(T&&o.selectedtile.selected){const l=K(t);l.valid&&U(l.x,l.y,o.selectedtile.column,o.selectedtile.row)&&G(l.x,l.y,o.selectedtile.column,o.selectedtile.row)}}function fe(e){const t=W(r,e);if(!T){const l=K(t);if(l.valid){let i=!1;if(o.selectedtile.selected)if(l.x===o.selectedtile.column&&l.y===o.selectedtile.row){o.selectedtile.selected=!1,T=!0;return}else U(l.x,l.y,o.selectedtile.column,o.selectedtile.row)&&(G(l.x,l.y,o.selectedtile.column,o.selectedtile.row),i=!0);i||(o.selectedtile.column=l.x,o.selectedtile.row=l.y,o.selectedtile.selected=!0)}else o.selectedtile.selected=!1;T=!0}for(const l of p)t.x>=l.x&&t.x<l.x+l.width&&t.y>=l.y&&t.y<l.y+l.height&&(l.text==="New Game"?D():l.text.includes("Show Moves")||l.text.includes("Hide Moves")?(O=!O,l.text=(O?"Hide":"Show")+" Moves"):(l.text.includes("Enable AI Bot")||l.text.includes("Disable AI Bot"))&&(B=!B,l.text=(B?"Disable":"Enable")+" AI Bot"))}function ce(e){console.info(e),T=!1}function ue(e){console.info(e),T=!1}function W(e,t){const l=e.getBoundingClientRect();return{x:Math.round((t.clientX-l.left)/(l.right-l.left)*e.width),y:Math.round((t.clientY-l.top)/(l.bottom-l.top)*e.height)}}J(),R();function de(){let e=null,t=-1/0;for(let l=0;l<o.rows;l++)for(let i=0;i<o.columns-1;i++){y(i,l,i+1,l);const s=q();y(i,l,i+1,l),s>t&&(t=s,e={column1:i,row1:l,column2:i+1,row2:l})}for(let l=0;l<o.columns;l++)for(let i=0;i<o.rows-1;i++){y(l,i,l,i+1);const s=q();y(l,i,l,i+1),s>t&&(t=s,e={column1:l,row1:i,column2:l,row2:i+1})}return e}};
