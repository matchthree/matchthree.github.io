(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))E(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const b of d.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&E(b)}).observe(document,{childList:!0,subtree:!0});function j(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerPolicy&&(d.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?d.credentials="include":r.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function E(r){if(r.ep)return;r.ep=!0;const d=j(r);fetch(r.href,d)}})();window.onload=function(){const c=document.getElementById("viewport"),i=c.getContext("2d");function j(){c.width=window.innerWidth,c.height=window.innerHeight,l.x=c.width*.1,l.y=c.height*.1,l.tilewidth=c.width*.8/l.columns,l.tileheight=c.height*.8/l.rows}window.addEventListener("resize",j);let E=0,r=0,d=0,b=0,T=!1;const l={x:250,y:113,columns:8,rows:8,tilewidth:40,tileheight:40,tiles:[],selectedtile:{selected:!1,column:0,row:0}},C=[[255,128,128],[128,255,128],[128,128,255],[255,255,128],[255,128,255],[128,255,255],[255,255,255]];let h=[],p=[],s={column1:0,row1:0,column2:0,row2:0};const m={init:0,ready:1,resolve:2};let w=m.init,A=0,a=0,u=0;const y=.3;let O=!1,B=!1,I=!1;const N=[{x:30,y:240,width:150,height:50,text:"New Game"},{x:30,y:300,width:150,height:50,text:"Show Moves"},{x:30,y:360,width:150,height:50,text:"Enable AI Bot"}];function W(){c.addEventListener("mousemove",ie),c.addEventListener("mousedown",ne),c.addEventListener("mouseup",se),c.addEventListener("mouseout",fe);for(let e=0;e<l.columns;e++){l.tiles[e]=[];for(let t=0;t<l.rows;t++)l.tiles[e][t]={type:0,shift:0}}G(),V(0)}function V(e){window.requestAnimationFrame(V),X(e),J()}function X(e){const t=(e-E)/1e3;if(E=e,Y(t),w===m.ready){if(p.length<=0&&(I=!0),B&&(u+=t,u>y)){if(L(),p.length>0){const o=p[Math.floor(Math.random()*p.length)];F(o.column1,o.row1,o.column2,o.row2)}u=0}}else if(w===m.resolve){if(u+=t,a===0){if(u>y){if(g(),h.length>0){for(const o of h)A+=100*(o.length-2);D(),a=1}else w=m.ready;u=0}}else a===1?u>y&&(H(),a=0,u=0,g(),h.length<=0&&(w=m.ready)):a===2?u>y&&(M(s.column1,s.row1,s.column2,s.row2),g(),h.length>0?(a=0,u=0,w=m.resolve):(a=3,u=0),L(),g()):a===3&&u>y&&(M(s.column1,s.row1,s.column2,s.row2),w=m.ready);L(),g()}}function Y(e){r>.25&&(b=Math.round(d/r),r=0,d=0),r+=e,d++}function P(e,t,o,n){const f=i.measureText(e);i.fillText(e,t+(n-f.width)/2,o)}function J(){Q(),i.fillStyle="#000000",i.font="24px Verdana",P("Score:",30,l.y+40,150),P(A.toString(),30,l.y+70,150),Z();const e=l.columns*l.tilewidth,t=l.rows*l.tileheight;i.fillStyle="#000000",i.fillRect(l.x-4,l.y-4,e+8,t+8),_(),k(),O&&h.length<=0&&w===m.ready&&ee(),I&&(i.fillStyle="rgba(0, 0, 0, 0.8)",i.fillRect(l.x,l.y,e,t),i.fillStyle="#ffffff",i.font="24px Verdana",P("Game Over!",l.x,l.y+t/2+10,e))}function Q(){i.fillStyle="#d0d0d0",i.fillRect(0,0,c.width,c.height),i.fillStyle="#e8eaec",i.fillRect(1,1,c.width-2,c.height-2),i.fillStyle="#303030",i.fillRect(0,0,c.width,65),i.fillStyle="#ffffff",i.font="24px Verdana",i.fillText("Match3 Example - Rembound.com",10,30),i.fillStyle="#ffffff",i.font="12px Verdana",i.fillText(`Fps: ${b}`,13,50)}function Z(){for(const e of N){i.fillStyle="#000000",i.fillRect(e.x,e.y,e.width,e.height),i.fillStyle="#ffffff",i.font="18px Verdana";const t=i.measureText(e.text);i.fillText(e.text,e.x+(e.width-t.width)/2,e.y+30)}}function _(){for(let e=0;e<l.columns;e++)for(let t=0;t<l.rows;t++){const o=l.tiles[e][t].shift,n=x(e,t,0,u/y*o);if(l.tiles[e][t].type>=0){const f=C[l.tiles[e][t].type];v(n.tilex,n.tiley,f[0],f[1],f[2])}l.selectedtile.selected&&l.selectedtile.column===e&&l.selectedtile.row===t&&v(n.tilex,n.tiley,255,0,0)}if(w===m.resolve&&(a===2||a===3)){const e=s.column2-s.column1,t=s.row2-s.row1,o=x(s.column1,s.row1,0,0),n=x(s.column1,s.row1,u/y*e,u/y*t),f=C[l.tiles[s.column1][s.row1].type],S=x(s.column2,s.row2,0,0),z=x(s.column2,s.row2,u/y*-e,u/y*-t),R=C[l.tiles[s.column2][s.row2].type];v(o.tilex,o.tiley,0,0,0),v(S.tilex,S.tiley,0,0,0),a===2?(v(n.tilex,n.tiley,f[0],f[1],f[2]),v(z.tilex,z.tiley,R[0],R[1],R[2])):(v(z.tilex,z.tiley,R[0],R[1],R[2]),v(n.tilex,n.tiley,f[0],f[1],f[2]))}}function x(e,t,o,n){const f=l.x+(e+o)*l.tilewidth,S=l.y+(t+n)*l.tileheight;return{tilex:f,tiley:S}}function v(e,t,o,n,f){i.fillStyle=`rgb(${o},${n},${f})`,i.fillRect(e+2,t+2,l.tilewidth-4,l.tileheight-4)}function k(){for(const e of h){const t=x(e.column,e.row,0,0);e.horizontal?(i.fillStyle="#00ff00",i.fillRect(t.tilex+l.tilewidth/2,t.tiley+l.tileheight/2-4,(e.length-1)*l.tilewidth,8)):(i.fillStyle="#0000ff",i.fillRect(t.tilex+l.tilewidth/2-4,t.tiley+l.tileheight/2,8,(e.length-1)*l.tileheight))}}function ee(){for(const e of p){const t=x(e.column1,e.row1,0,0),o=x(e.column2,e.row2,0,0);i.strokeStyle="#ff0000",i.beginPath(),i.moveTo(t.tilex+l.tilewidth/2,t.tiley+l.tileheight/2),i.lineTo(o.tilex+l.tilewidth/2,o.tiley+l.tileheight/2),i.stroke()}}function G(){A=0,w=m.ready,I=!1,te(),L(),g()}function te(){let e=!1;for(;!e;){for(let t=0;t<l.columns;t++)for(let o=0;o<l.rows;o++)l.tiles[t][o].type=$();le(),L(),p.length>0&&(e=!0)}}function $(){return Math.floor(Math.random()*C.length)}function le(){for(g();h.length>0;)D(),H(),g()}function g(){h=[];for(let e=0;e<l.rows;e++){let t=1;for(let o=0;o<l.columns;o++){let n=!1;o===l.columns-1?n=!0:l.tiles[o][e].type===l.tiles[o+1][e].type&&l.tiles[o][e].type!==-1?t+=1:n=!0,n&&(t>=3&&h.push({column:o+1-t,row:e,length:t,horizontal:!0}),t=1)}}for(let e=0;e<l.columns;e++){let t=1;for(let o=0;o<l.rows;o++){let n=!1;o===l.rows-1?n=!0:l.tiles[e][o].type===l.tiles[e][o+1].type&&l.tiles[e][o].type!==-1?t+=1:n=!0,n&&(t>=3&&h.push({column:e,row:o+1-t,length:t,horizontal:!1}),t=1)}}}function L(){p=[];for(let e=0;e<l.rows;e++)for(let t=0;t<l.columns-1;t++)M(t,e,t+1,e),g(),M(t,e,t+1,e),h.length>0&&p.push({column1:t,row1:e,column2:t+1,row2:e});for(let e=0;e<l.columns;e++)for(let t=0;t<l.rows-1;t++)M(e,t,e,t+1),g(),M(e,t,e,t+1),h.length>0&&p.push({column1:e,row1:t,column2:e,row2:t+1});h=[]}function oe(e){for(let t=0;t<h.length;t++){const o=h[t];let n=0,f=0;for(let S=0;S<o.length;S++)e(t,o.column+n,o.row+f,o),o.horizontal?n++:f++}}function D(){oe((e,t,o,n)=>{console.info(e),console.info(n),l.tiles[t][o].type=-1});for(let e=0;e<l.columns;e++){let t=0;for(let o=l.rows-1;o>=0;o--)l.tiles[e][o].type===-1?(t++,l.tiles[e][o].shift=0):l.tiles[e][o].shift=t}}function H(){for(let e=0;e<l.columns;e++)for(let t=l.rows-1;t>=0;t--){if(l.tiles[e][t].type===-1)l.tiles[e][t].type=$();else{const o=l.tiles[e][t].shift;o>0&&M(e,t,e,t+o)}l.tiles[e][t].shift=0}}function q(e){const t=Math.floor((e.x-l.x)/l.tilewidth),o=Math.floor((e.y-l.y)/l.tileheight);return t>=0&&t<l.columns&&o>=0&&o<l.rows?{valid:!0,x:t,y:o}:{valid:!1,x:0,y:0}}function K(e,t,o,n){return Math.abs(e-o)===1&&t===n||Math.abs(t-n)===1&&e===o}function M(e,t,o,n){const f=l.tiles[e][t].type;l.tiles[e][t].type=l.tiles[o][n].type,l.tiles[o][n].type=f}function F(e,t,o,n){s={column1:e,row1:t,column2:o,row2:n},l.selectedtile.selected=!1,a=2,u=0,w=m.resolve}function ie(e){const t=U(c,e);if(T&&l.selectedtile.selected){const o=q(t);o.valid&&K(o.x,o.y,l.selectedtile.column,l.selectedtile.row)&&F(o.x,o.y,l.selectedtile.column,l.selectedtile.row)}}function ne(e){const t=U(c,e);if(!T){const o=q(t);if(o.valid){let n=!1;if(l.selectedtile.selected)if(o.x===l.selectedtile.column&&o.y===l.selectedtile.row){l.selectedtile.selected=!1,T=!0;return}else K(o.x,o.y,l.selectedtile.column,l.selectedtile.row)&&(F(o.x,o.y,l.selectedtile.column,l.selectedtile.row),n=!0);n||(l.selectedtile.column=o.x,l.selectedtile.row=o.y,l.selectedtile.selected=!0)}else l.selectedtile.selected=!1;T=!0}for(const o of N)t.x>=o.x&&t.x<o.x+o.width&&t.y>=o.y&&t.y<o.y+o.height&&(o.text==="New Game"?G():o.text.includes("Show Moves")||o.text.includes("Hide Moves")?(O=!O,o.text=(O?"Hide":"Show")+" Moves"):(o.text.includes("Enable AI Bot")||o.text.includes("Disable AI Bot"))&&(B=!B,o.text=(B?"Disable":"Enable")+" AI Bot"))}function se(e){console.info(e),T=!1}function fe(e){console.info(e),T=!1}function U(e,t){const o=e.getBoundingClientRect();return{x:Math.round((t.clientX-o.left)/(o.right-o.left)*e.width),y:Math.round((t.clientY-o.top)/(o.bottom-o.top)*e.height)}}W(),j()};
