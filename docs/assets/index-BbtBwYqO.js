(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))R(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const b of u.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&R(b)}).observe(document,{childList:!0,subtree:!0});function j(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function R(r){if(r.ep)return;r.ep=!0;const u=j(r);fetch(r.href,u)}})();window.onload=function(){const h=document.getElementById("viewport"),i=h.getContext("2d");function j(){const e=document.getElementById("viewport");e.width=window.innerWidth,e.height=window.innerHeight}window.addEventListener("resize",j),j();let R=0,r=0,u=0,b=0,T=!1;const o={x:250,y:113,columns:8,rows:8,tilewidth:40,tileheight:40,tiles:[],selectedtile:{selected:!1,column:0,row:0}},C=[[255,128,128],[128,255,128],[128,128,255],[255,255,128],[255,128,255],[128,255,255],[255,255,255]];let d=[],p=[],s={column1:0,row1:0,column2:0,row2:0};const m={init:0,ready:1,resolve:2};let w=m.init,z=0,a=0,c=0;const y=.3;let B=!1,O=!1,A=!1;const N=[{x:30,y:240,width:150,height:50,text:"New Game"},{x:30,y:300,width:150,height:50,text:"Show Moves"},{x:30,y:360,width:150,height:50,text:"Enable AI Bot"}];function W(){h.addEventListener("mousemove",ie),h.addEventListener("mousedown",ne),h.addEventListener("mouseup",se),h.addEventListener("mouseout",fe);for(let e=0;e<o.columns;e++){o.tiles[e]=[];for(let t=0;t<o.rows;t++)o.tiles[e][t]={type:0,shift:0}}G(),V(0)}function V(e){window.requestAnimationFrame(V),X(e),J()}function X(e){const t=(e-R)/1e3;if(R=e,Y(t),w===m.ready){if(p.length<=0&&(A=!0),O&&(c+=t,c>y)){if(L(),p.length>0){const l=p[Math.floor(Math.random()*p.length)];F(l.column1,l.row1,l.column2,l.row2)}c=0}}else if(w===m.resolve){if(c+=t,a===0){if(c>y){if(g(),d.length>0){for(const l of d)z+=100*(l.length-2);D(),a=1}else w=m.ready;c=0}}else a===1?c>y&&(H(),a=0,c=0,g(),d.length<=0&&(w=m.ready)):a===2?c>y&&(M(s.column1,s.row1,s.column2,s.row2),g(),d.length>0?(a=0,c=0,w=m.resolve):(a=3,c=0),L(),g()):a===3&&c>y&&(M(s.column1,s.row1,s.column2,s.row2),w=m.ready);L(),g()}}function Y(e){r>.25&&(b=Math.round(u/r),r=0,u=0),r+=e,u++}function P(e,t,l,n){const f=i.measureText(e);i.fillText(e,t+(n-f.width)/2,l)}function J(){Q(),i.fillStyle="#000000",i.font="24px Verdana",P("Score:",30,o.y+40,150),P(z.toString(),30,o.y+70,150),Z();const e=o.columns*o.tilewidth,t=o.rows*o.tileheight;i.fillStyle="#000000",i.fillRect(o.x-4,o.y-4,e+8,t+8),_(),k(),B&&d.length<=0&&w===m.ready&&ee(),A&&(i.fillStyle="rgba(0, 0, 0, 0.8)",i.fillRect(o.x,o.y,e,t),i.fillStyle="#ffffff",i.font="24px Verdana",P("Game Over!",o.x,o.y+t/2+10,e))}function Q(){i.fillStyle="#d0d0d0",i.fillRect(0,0,h.width,h.height),i.fillStyle="#e8eaec",i.fillRect(1,1,h.width-2,h.height-2),i.fillStyle="#303030",i.fillRect(0,0,h.width,65),i.fillStyle="#ffffff",i.font="24px Verdana",i.fillText("Match3 Example - Rembound.com",10,30),i.fillStyle="#ffffff",i.font="12px Verdana",i.fillText(`Fps: ${b}`,13,50)}function Z(){for(const e of N){i.fillStyle="#000000",i.fillRect(e.x,e.y,e.width,e.height),i.fillStyle="#ffffff",i.font="18px Verdana";const t=i.measureText(e.text);i.fillText(e.text,e.x+(e.width-t.width)/2,e.y+30)}}function _(){for(let e=0;e<o.columns;e++)for(let t=0;t<o.rows;t++){const l=o.tiles[e][t].shift,n=x(e,t,0,c/y*l);if(o.tiles[e][t].type>=0){const f=C[o.tiles[e][t].type];v(n.tilex,n.tiley,f[0],f[1],f[2])}o.selectedtile.selected&&o.selectedtile.column===e&&o.selectedtile.row===t&&v(n.tilex,n.tiley,255,0,0)}if(w===m.resolve&&(a===2||a===3)){const e=s.column2-s.column1,t=s.row2-s.row1,l=x(s.column1,s.row1,0,0),n=x(s.column1,s.row1,c/y*e,c/y*t),f=C[o.tiles[s.column1][s.row1].type],S=x(s.column2,s.row2,0,0),I=x(s.column2,s.row2,c/y*-e,c/y*-t),E=C[o.tiles[s.column2][s.row2].type];v(l.tilex,l.tiley,0,0,0),v(S.tilex,S.tiley,0,0,0),a===2?(v(n.tilex,n.tiley,f[0],f[1],f[2]),v(I.tilex,I.tiley,E[0],E[1],E[2])):(v(I.tilex,I.tiley,E[0],E[1],E[2]),v(n.tilex,n.tiley,f[0],f[1],f[2]))}}function x(e,t,l,n){const f=o.x+(e+l)*o.tilewidth,S=o.y+(t+n)*o.tileheight;return{tilex:f,tiley:S}}function v(e,t,l,n,f){i.fillStyle=`rgb(${l},${n},${f})`,i.fillRect(e+2,t+2,o.tilewidth-4,o.tileheight-4)}function k(){for(const e of d){const t=x(e.column,e.row,0,0);e.horizontal?(i.fillStyle="#00ff00",i.fillRect(t.tilex+o.tilewidth/2,t.tiley+o.tileheight/2-4,(e.length-1)*o.tilewidth,8)):(i.fillStyle="#0000ff",i.fillRect(t.tilex+o.tilewidth/2-4,t.tiley+o.tileheight/2,8,(e.length-1)*o.tileheight))}}function ee(){for(const e of p){const t=x(e.column1,e.row1,0,0),l=x(e.column2,e.row2,0,0);i.strokeStyle="#ff0000",i.beginPath(),i.moveTo(t.tilex+o.tilewidth/2,t.tiley+o.tileheight/2),i.lineTo(l.tilex+o.tilewidth/2,l.tiley+o.tileheight/2),i.stroke()}}function G(){z=0,w=m.ready,A=!1,te(),L(),g()}function te(){let e=!1;for(;!e;){for(let t=0;t<o.columns;t++)for(let l=0;l<o.rows;l++)o.tiles[t][l].type=$();le(),L(),p.length>0&&(e=!0)}}function $(){return Math.floor(Math.random()*C.length)}function le(){for(g();d.length>0;)D(),H(),g()}function g(){d=[];for(let e=0;e<o.rows;e++){let t=1;for(let l=0;l<o.columns;l++){let n=!1;l===o.columns-1?n=!0:o.tiles[l][e].type===o.tiles[l+1][e].type&&o.tiles[l][e].type!==-1?t+=1:n=!0,n&&(t>=3&&d.push({column:l+1-t,row:e,length:t,horizontal:!0}),t=1)}}for(let e=0;e<o.columns;e++){let t=1;for(let l=0;l<o.rows;l++){let n=!1;l===o.rows-1?n=!0:o.tiles[e][l].type===o.tiles[e][l+1].type&&o.tiles[e][l].type!==-1?t+=1:n=!0,n&&(t>=3&&d.push({column:e,row:l+1-t,length:t,horizontal:!1}),t=1)}}}function L(){p=[];for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns-1;t++)M(t,e,t+1,e),g(),M(t,e,t+1,e),d.length>0&&p.push({column1:t,row1:e,column2:t+1,row2:e});for(let e=0;e<o.columns;e++)for(let t=0;t<o.rows-1;t++)M(e,t,e,t+1),g(),M(e,t,e,t+1),d.length>0&&p.push({column1:e,row1:t,column2:e,row2:t+1});d=[]}function oe(e){for(let t=0;t<d.length;t++){const l=d[t];let n=0,f=0;for(let S=0;S<l.length;S++)e(t,l.column+n,l.row+f,l),l.horizontal?n++:f++}}function D(){oe((e,t,l,n)=>{console.info(e),console.info(n),o.tiles[t][l].type=-1});for(let e=0;e<o.columns;e++){let t=0;for(let l=o.rows-1;l>=0;l--)o.tiles[e][l].type===-1?(t++,o.tiles[e][l].shift=0):o.tiles[e][l].shift=t}}function H(){for(let e=0;e<o.columns;e++)for(let t=o.rows-1;t>=0;t--){if(o.tiles[e][t].type===-1)o.tiles[e][t].type=$();else{const l=o.tiles[e][t].shift;l>0&&M(e,t,e,t+l)}o.tiles[e][t].shift=0}}function q(e){const t=Math.floor((e.x-o.x)/o.tilewidth),l=Math.floor((e.y-o.y)/o.tileheight);return t>=0&&t<o.columns&&l>=0&&l<o.rows?{valid:!0,x:t,y:l}:{valid:!1,x:0,y:0}}function K(e,t,l,n){return Math.abs(e-l)===1&&t===n||Math.abs(t-n)===1&&e===l}function M(e,t,l,n){const f=o.tiles[e][t].type;o.tiles[e][t].type=o.tiles[l][n].type,o.tiles[l][n].type=f}function F(e,t,l,n){s={column1:e,row1:t,column2:l,row2:n},o.selectedtile.selected=!1,a=2,c=0,w=m.resolve}function ie(e){const t=U(h,e);if(T&&o.selectedtile.selected){const l=q(t);l.valid&&K(l.x,l.y,o.selectedtile.column,o.selectedtile.row)&&F(l.x,l.y,o.selectedtile.column,o.selectedtile.row)}}function ne(e){const t=U(h,e);if(!T){const l=q(t);if(l.valid){let n=!1;if(o.selectedtile.selected)if(l.x===o.selectedtile.column&&l.y===o.selectedtile.row){o.selectedtile.selected=!1,T=!0;return}else K(l.x,l.y,o.selectedtile.column,o.selectedtile.row)&&(F(l.x,l.y,o.selectedtile.column,o.selectedtile.row),n=!0);n||(o.selectedtile.column=l.x,o.selectedtile.row=l.y,o.selectedtile.selected=!0)}else o.selectedtile.selected=!1;T=!0}for(const l of N)t.x>=l.x&&t.x<l.x+l.width&&t.y>=l.y&&t.y<l.y+l.height&&(l.text==="New Game"?G():l.text.includes("Show Moves")||l.text.includes("Hide Moves")?(B=!B,l.text=(B?"Hide":"Show")+" Moves"):(l.text.includes("Enable AI Bot")||l.text.includes("Disable AI Bot"))&&(O=!O,l.text=(O?"Disable":"Enable")+" AI Bot"))}function se(e){console.info(e),T=!1}function fe(e){console.info(e),T=!1}function U(e,t){const l=e.getBoundingClientRect();return{x:Math.round((t.clientX-l.left)/(l.right-l.left)*e.width),y:Math.round((t.clientY-l.top)/(l.bottom-l.top)*e.height)}}W()};
