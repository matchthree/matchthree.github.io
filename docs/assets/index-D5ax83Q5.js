(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))R(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const b of d.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&R(b)}).observe(document,{childList:!0,subtree:!0});function C(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function R(c){if(c.ep)return;c.ep=!0;const d=C(c);fetch(c.href,d)}})();window.onload=function(){const s=document.getElementById("viewport"),n=s.getContext("2d");function C(){s.width=window.innerWidth,s.height=window.innerHeight,o.x=s.width*.05,o.y=s.height*.22,o.tilewidth=s.width*.8/o.columns,o.tileheight=s.height*.65/o.rows,p[0].x=s.width*.05,p[0].y=s.height*.06,p[1].x=s.width*.05,p[1].y=s.height*.11,p[2].x=s.width*.05,p[2].y=s.height*.16,N=s.width*.2,V=s.height*.02}window.addEventListener("resize",C);let R=0,c=0,d=0,b=0,T=!1;const o={x:250,y:113,columns:8,rows:8,tilewidth:40,tileheight:40,tiles:[],selectedtile:{selected:!1,column:0,row:0}},E=[[255,128,128],[128,255,128],[128,128,255],[255,255,128],[255,128,255],[128,255,255],[255,255,255]];let h=[],j=[],f={column1:0,row1:0,column2:0,row2:0};const w={init:0,ready:1,resolve:2};let y=w.init,I=0,a=0,u=0;const g=.3;let O=!1,B=!1,P=!1;const p=[{x:30,y:240,width:150,height:50,text:"New Game"},{x:30,y:300,width:150,height:50,text:"Show Moves"},{x:30,y:360,width:150,height:50,text:"Enable AI Bot"}];function J(){s.addEventListener("mousemove",re),s.addEventListener("mousedown",fe),s.addEventListener("mouseup",ce),s.addEventListener("mouseout",ue);for(let e=0;e<o.columns;e++){o.tiles[e]=[];for(let l=0;l<o.rows;l++)o.tiles[e][l]={type:0,shift:0}}D(),$(0)}function $(e){window.requestAnimationFrame($),Q(e),k()}function Q(e){const l=(e-R)/1e3;if(R=e,Z(l),y===w.ready){if(j.length<=0&&(P=!0),B&&(u+=l,u>g)){const t=de();t&&G(t.column1,t.row1,t.column2,t.row2),u=0}}else if(y===w.resolve){if(u+=l,a===0){if(u>g){if(x(),h.length>0){for(const t of h)I+=100*(t.length-2);q(),a=1}else y=w.ready;u=0}}else a===1?u>g&&(X(),a=0,u=0,x(),h.length<=0&&(y=w.ready)):a===2?u>g&&(m(f.column1,f.row1,f.column2,f.row2),x(),h.length>0?(a=0,u=0,y=w.resolve):(a=3,u=0),z(),x()):a===3&&u>g&&(m(f.column1,f.row1,f.column2,f.row2),y=w.ready);z(),x()}}function Z(e){c>.25&&(b=Math.round(d/c),c=0,d=0),c+=e,d++}function F(e,l,t,i){const r=n.measureText(e);n.fillText(e,l+(i-r.width)/2,t)}function _(){n.fillStyle="#d0d0d0",n.fillRect(0,0,s.width,s.height),n.fillStyle="#e8eaec",n.fillRect(1,1,s.width-2,s.height-2),n.fillStyle="#303030",n.fillRect(0,0,s.width,65),n.fillStyle="#ffffff",n.font="24px Verdana",n.fillText("match",10,30),n.fillStyle="#ffffff",n.font="12px Verdana",n.fillText(`Fps: ${b}`,13,50)}let N=30,V=40;function k(){_(),n.fillStyle="#000000",n.font="24px Verdana",F("Score:",N,V,150),F(I.toString(),N,V+30,150),ee();const e=o.columns*o.tilewidth,l=o.rows*o.tileheight;n.fillStyle="#000000",n.fillRect(o.x-4,o.y-4,e+8,l+8),te(),le(),O&&h.length<=0&&y===w.ready&&oe(),P&&(n.fillStyle="rgba(0, 0, 0, 0.8)",n.fillRect(o.x,o.y,e,l),n.fillStyle="#ffffff",n.font="24px Verdana",F("Game Over!",o.x,o.y+l/2+10,e))}function ee(){for(const e of p){n.fillStyle="#000000",n.fillRect(e.x,e.y,e.width,e.height),n.fillStyle="#ffffff",n.font="18px Verdana";const l=n.measureText(e.text);n.fillText(e.text,e.x+(e.width-l.width)/2,e.y+30)}}function te(){for(let e=0;e<o.columns;e++)for(let l=0;l<o.rows;l++){const t=o.tiles[e][l].shift,i=v(e,l,0,u/g*t);if(o.tiles[e][l].type>=0){const r=E[o.tiles[e][l].type];M(i.tilex,i.tiley,r[0],r[1],r[2])}o.selectedtile.selected&&o.selectedtile.column===e&&o.selectedtile.row===l&&M(i.tilex,i.tiley,255,0,0)}if(y===w.resolve&&(a===2||a===3)){const e=f.column2-f.column1,l=f.row2-f.row1,t=v(f.column1,f.row1,0,0),i=v(f.column1,f.row1,u/g*e,u/g*l),r=E[o.tiles[f.column1][f.row1].type],S=v(f.column2,f.row2,0,0),A=v(f.column2,f.row2,u/g*-e,u/g*-l),L=E[o.tiles[f.column2][f.row2].type];M(t.tilex,t.tiley,0,0,0),M(S.tilex,S.tiley,0,0,0),a===2?(M(i.tilex,i.tiley,r[0],r[1],r[2]),M(A.tilex,A.tiley,L[0],L[1],L[2])):(M(A.tilex,A.tiley,L[0],L[1],L[2]),M(i.tilex,i.tiley,r[0],r[1],r[2]))}}function v(e,l,t,i){const r=o.x+(e+t)*o.tilewidth,S=o.y+(l+i)*o.tileheight;return{tilex:r,tiley:S}}function M(e,l,t,i,r){n.fillStyle=`rgb(${t},${i},${r})`,n.fillRect(e+2,l+2,o.tilewidth-4,o.tileheight-4)}function le(){for(const e of h){const l=v(e.column,e.row,0,0);e.horizontal?(n.fillStyle="#00ff00",n.fillRect(l.tilex+o.tilewidth/2,l.tiley+o.tileheight/2-4,(e.length-1)*o.tilewidth,8)):(n.fillStyle="#0000ff",n.fillRect(l.tilex+o.tilewidth/2-4,l.tiley+o.tileheight/2,8,(e.length-1)*o.tileheight))}}function oe(){for(const e of j){const l=v(e.column1,e.row1,0,0),t=v(e.column2,e.row2,0,0);n.strokeStyle="#ff0000",n.beginPath(),n.moveTo(l.tilex+o.tilewidth/2,l.tiley+o.tileheight/2),n.lineTo(t.tilex+o.tilewidth/2,t.tiley+o.tileheight/2),n.stroke()}}function D(){I=0,y=w.ready,P=!1,ie(),z(),x()}function ie(){let e=!1;for(;!e;){for(let l=0;l<o.columns;l++)for(let t=0;t<o.rows;t++)o.tiles[l][t].type=H();ne(),z(),j.length>0&&(e=!0)}}function H(){return Math.floor(Math.random()*E.length)}function ne(){for(x();h.length>0;)q(),X(),x()}function x(){h=[];for(let e=0;e<o.rows;e++){let l=1;for(let t=0;t<o.columns;t++){let i=!1;t===o.columns-1?i=!0:o.tiles[t][e].type===o.tiles[t+1][e].type&&o.tiles[t][e].type!==-1?l+=1:i=!0,i&&(l>=3&&h.push({column:t+1-l,row:e,length:l,horizontal:!0}),l=1)}}for(let e=0;e<o.columns;e++){let l=1;for(let t=0;t<o.rows;t++){let i=!1;t===o.rows-1?i=!0:o.tiles[e][t].type===o.tiles[e][t+1].type&&o.tiles[e][t].type!==-1?l+=1:i=!0,i&&(l>=3&&h.push({column:e,row:t+1-l,length:l,horizontal:!1}),l=1)}}}function z(){j=[];for(let e=0;e<o.rows;e++)for(let l=0;l<o.columns-1;l++)m(l,e,l+1,e),x(),m(l,e,l+1,e),h.length>0&&j.push({column1:l,row1:e,column2:l+1,row2:e});for(let e=0;e<o.columns;e++)for(let l=0;l<o.rows-1;l++)m(e,l,e,l+1),x(),m(e,l,e,l+1),h.length>0&&j.push({column1:e,row1:l,column2:e,row2:l+1});h=[]}function se(e){for(let l=0;l<h.length;l++){const t=h[l];let i=0,r=0;for(let S=0;S<t.length;S++)e(l,t.column+i,t.row+r,t),t.horizontal?i++:r++}}function q(){se((e,l,t,i)=>{console.info(e),console.info(i),o.tiles[l][t].type=-1});for(let e=0;e<o.columns;e++){let l=0;for(let t=o.rows-1;t>=0;t--)o.tiles[e][t].type===-1?(l++,o.tiles[e][t].shift=0):o.tiles[e][t].shift=l}}function X(){for(let e=0;e<o.columns;e++)for(let l=o.rows-1;l>=0;l--){if(o.tiles[e][l].type===-1)o.tiles[e][l].type=H();else{const t=o.tiles[e][l].shift;t>0&&m(e,l,e,l+t)}o.tiles[e][l].shift=0}}function Y(e){const l=Math.floor((e.x-o.x)/o.tilewidth),t=Math.floor((e.y-o.y)/o.tileheight);return l>=0&&l<o.columns&&t>=0&&t<o.rows?{valid:!0,x:l,y:t}:{valid:!1,x:0,y:0}}function K(e,l,t,i){return Math.abs(e-t)===1&&l===i||Math.abs(l-i)===1&&e===t}function m(e,l,t,i){const r=o.tiles[e][l].type;o.tiles[e][l].type=o.tiles[t][i].type,o.tiles[t][i].type=r}function G(e,l,t,i){f={column1:e,row1:l,column2:t,row2:i},o.selectedtile.selected=!1,a=2,u=0,y=w.resolve}function re(e){const l=U(s,e);if(T&&o.selectedtile.selected){const t=Y(l);t.valid&&K(t.x,t.y,o.selectedtile.column,o.selectedtile.row)&&G(t.x,t.y,o.selectedtile.column,o.selectedtile.row)}}function fe(e){const l=U(s,e);if(!T){const t=Y(l);if(t.valid){let i=!1;if(o.selectedtile.selected)if(t.x===o.selectedtile.column&&t.y===o.selectedtile.row){o.selectedtile.selected=!1,T=!0;return}else K(t.x,t.y,o.selectedtile.column,o.selectedtile.row)&&(G(t.x,t.y,o.selectedtile.column,o.selectedtile.row),i=!0);i||(o.selectedtile.column=t.x,o.selectedtile.row=t.y,o.selectedtile.selected=!0)}else o.selectedtile.selected=!1;T=!0}for(const t of p)l.x>=t.x&&l.x<t.x+t.width&&l.y>=t.y&&l.y<t.y+t.height&&(t.text==="New Game"?D():t.text.includes("Show Moves")||t.text.includes("Hide Moves")?(O=!O,t.text=(O?"Hide":"Show")+" Moves"):(t.text.includes("Enable AI Bot")||t.text.includes("Disable AI Bot"))&&(B=!B,t.text=(B?"Disable":"Enable")+" AI Bot"))}function ce(e){console.info(e),T=!1}function ue(e){console.info(e),T=!1}function U(e,l){const t=e.getBoundingClientRect();return{x:Math.round((l.clientX-t.left)/(t.right-t.left)*e.width),y:Math.round((l.clientY-t.top)/(t.bottom-t.top)*e.height)}}J(),C();function de(){let e=null,l=0;for(let t=0;t<o.rows;t++)for(let i=0;i<o.columns-1;i++){m(i,t,i+1,t);const r=W();m(i,t,i+1,t),r>l&&(l=r,e={column1:i,row1:t,column2:i+1,row2:t})}for(let t=0;t<o.columns;t++)for(let i=0;i<o.rows-1;i++){m(t,i,t,i+1);const r=W();m(t,i,t,i+1),r>l&&(l=r,e={column1:t,row1:i,column2:t,row2:i+1})}return e}function W(){return Math.random()}};
